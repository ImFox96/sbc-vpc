# sbc-vpc

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è Orange Pi (–∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ SBC), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Delta DVP –ø–æ USB/Modbus –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ slave. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–æ–¥–±–∞—Å-—Å–ª–µ–π–≤–∞, –∫–æ—Ç–æ—Ä—ã–π —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Delta –∏ –ø–æ–∑–≤–æ–ª–∏—Ç –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º —Å—Ç—Ä–æ–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –∑–∞–ø—É—Å–∫ Modbus RTU slave —á–µ—Ä–µ–∑ `pymodbus`.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏, –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö Delta DVP.
- –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –¥–ª—è –æ–±–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è UI.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

## –ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ Delta

```bash
python -m sbc_vpc --port /dev/ttyUSB0 --baudrate 9600 --unit-id 1
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (`--port`, `--baudrate`, `--parity` –∏ —Ç.–¥.) –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ–¥ —Å–≤–æ—ë –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –ª–æ–≥–∏, –æ—Ç—Ä–∞–∂–∞—é—â–∏–µ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Delta DVP.

> üí° –ï—Å–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª–∏–Ω–∏—è ¬´–º–æ–ª—á–∏—Ç¬ª, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ–∂–∏–º `7E1`:
>
> ```bash
> python -m sbc_vpc --bytesize 7 --parity E --stopbits 1
> ```

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –ø–æ–ª–µ–∑–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å JSON-—Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –∏ –ø–∏—Å–∞—Ç—å –∏—Ö –≤ journald:

```bash
python -m sbc_vpc --json-logs | systemd-cat -t sbc-vpc
```

–ü—Ä–∏–º–µ—Ä `systemd`-—é–Ω–∏—Ç–∞ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∂—É—Ä–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ `journald`:

```ini
[Unit]
Description=Orange Pi Modbus slave for Delta DVP
After=network-online.target

[Service]
Type=simple
User=orangepi
Group=orangepi
ExecStart=/usr/bin/python -m sbc_vpc --port /dev/ttyUSB0 --baudrate 9600 --unit-id 1 --json-logs
Restart=on-failure
RestartSec=5s
StandardOutput=journal
StandardError=journal
SyslogIdentifier=sbc-vpc

[Install]
WantedBy=multi-user.target
```

–ñ—É—Ä–Ω–∞–ª—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `journalctl -u sbc-vpc.service` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è `systemd`.

## –¢–µ—Å—Ç—ã

```bash
pip install pytest
pytest
```

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É Orange Pi –∏ Delta DVP.
- –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
